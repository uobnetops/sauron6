/* convert Sauron database format from 1.4beta to 1.5beta */
/* (this requires PostgreSQL v7.3 or later) */

ALTER TABLE deleted_hosts ADD COLUMN duid character varying(40);
ALTER TABLE hosts ADD COLUMN duid character varying(40);
ALTER TABLE leases ADD COLUMN duid character varying(40);

ALTER TABLE servers ADD COLUMN df_port6 integer DEFAULT 520;
ALTER TABLE servers ADD COLUMN df_max_delay6 integer DEFAULT 60;
ALTER TABLE servers ADD COLUMN df_max_uupdates6 integer DEFAULT 10;
ALTER TABLE servers ADD COLUMN df_mclt6 integer DEFAULT 3600;
ALTER TABLE servers ADD COLUMN df_split6 integer DEFAULT 128;
ALTER TABLE servers ADD COLUMN df_loadbalmax6 integer DEFAULT 3;
ALTER TABLE servers ADD COLUMN dhcp_flags6 integer DEFAULT 0;

CREATE TABLE dhcp_entries6 (
    id integer NOT NULL,
    type integer NOT NULL,
    ref integer NOT NULL,
    dhcp text,
    comment text
);

ALTER TABLE public.dhcp_entries6 OWNER TO sauron;
CREATE SEQUENCE dhcp_entries6_id_seq START WITH 1 INCREMENT BY 1 NO MAXVALUE NO MINVALUE CACHE 1;
ALTER TABLE public.dhcp_entries6_id_seq OWNER TO sauron;
ALTER SEQUENCE dhcp_entries6_id_seq OWNED BY dhcp_entries6.id;
ALTER TABLE ONLY dhcp_entries6 ALTER COLUMN id SET DEFAULT nextval('dhcp_entries6_id_seq'::regclass);
ALTER TABLE ONLY dhcp_entries6 ADD CONSTRAINT dhcp_entries6_pkey PRIMARY KEY (id);
CREATE INDEX dhcp_entries6_ref_index ON dhcp_entries6 USING btree (type, ref);

UPDATE settings SET value='1.5' where setting='dbversion';

/* eof */
